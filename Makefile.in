
## Available defines for building chm_lib with particular options
# CHM_MT:        build thread-safe version of chm_lib
# CHM_USE_PREAD: build chm_lib to use pread/pread64 for all I/O
# CHM_USE_IO64:  build chm_lib to support 64-bit file I/O
#
# Note: LDFLAGS must contain -lpthread if you are using -DCHM_MT.
#
#CFLAGS=-DCHM_MT -DCHM_USE_PREAD -DCHM_USE_IO64
#CFLAGS=-DCHM_MT -DCHM_USE_PREAD -DCHM_USE_IO64 -g -DDMALLOC_DISABLE
CFLAGS=@CFLAGS@ @CHM_MT@ @CHM_USE_PREAD@ @CHM_USE_IO64@ @DMALLOC_DISABLE@ 
LDFLAGS=@LDFLAGS@
prefix=@prefix@
libdir=@libdir@
exec_prefix=@exec_prefix@
includedir=@includedir@
CC=@CC@
top_builddir=@top_builddir@
ifeq ($(top_builddir),)
top_builddir=$(shell pwd)
endif
srcdir=@srcdir@
LIBTOOL=@LIBTOOL@
EXAMPLES=@EXAMPLES@

all: src/libchm.la

examples: ${EXAMPLES}

src/%.lo: $(srcdir)/src/%.c
	${LIBTOOL} --mode=compile ${CC} -c -o $@ $^ ${CFLAGS}

src/libchm.la: src/chm_lib.lo src/lzx.lo
	${LIBTOOL} --mode=link ${CC} -o $@ $^ ${LDFLAGS} -rpath $(libdir)

install: src/libchm.la
	mkdir -p $(DESTDIR)$(prefix) $(DESTDIR)$(libdir) $(DESTDIR)$(includedir)
	${LIBTOOL} --mode=install install -m0755 src/libchm.la $(DESTDIR)$(libdir)/
	install -m0644 $(srcdir)/src/chm_lib.h $(DESTDIR)$(includedir)/

clean:
	rm -fr src/libchm.la src/*.o src/*.lo .libs src/.libs src/${EXAMPLES}

test_chmLib: $(srcdir)/src/test_chmLib.c
	${CC} -o $@ $^ -I$(includedir) -L$(libdir) -lchm ${CFLAGS}

enum_chmLib: $(srcdir)/src/enum_chmLib.c
	${CC} -o $@ $^ -I$(includedir) -L$(libdir) -lchm ${CFLAGS}

enumdir_chmLib: $(srcdir)/src/enumdir_chmLib.c
	${CC} -o $@ $^ -I$(includedir) -L$(libdir) -lchm ${CFLAGS}

extract_chmLib: $(srcdir)/src/extract_chmLib.c
	${CC} -o $@ $^ -I$(includedir) -L$(libdir) -lchm ${CFLAGS}

chm_http: $(srcdir)/src/chm_http.c
	${CC} -o $@ $^ -I$(includedir) -L$(libdir) -lchm -lpthread ${CFLAGS}

